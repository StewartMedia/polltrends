{% extends "base.html" %}
{% block title %}PolTrends Australia — News{% endblock %}
{% block content %}
<p class="updated">Last updated: {{ updated }}</p>

{% if news %}
{% for code, ent in entities.items() %}
{% set articles = news.get(code, []) %}
{% if articles %}
<div class="card">
    <h2 style="border-left: 4px solid {{ ent.color }}; padding-left: 0.75rem;">
        {{ ent.short_name }} — Latest News
    </h2>
    {% for article in articles %}
    <div class="news-item">
        <a href="{{ article.url }}" target="_blank" rel="noopener" class="news-title">{{ article.title }}</a>
        <span class="news-meta">{{ article.source }} — {{ article.date }}</span>
    </div>
    {% endfor %}
</div>
{% endif %}
{% endfor %}
{% else %}
<div class="card">
    <p style="color: #999;">No news data available yet. News is fetched daily from Google News.</p>
</div>
{% endif %}

{% if spikes %}
<div class="card">
    <h2>Recent Spikes &amp; Associated News</h2>
    {% for spike in spikes %}
    <div class="spike-item" style="border-left: 4px solid {{ entities[spike.party_code].color }}; padding-left: 1rem; margin-bottom: 1.5rem;">
        <div class="spike-header">
            <strong>{{ spike.party_name }}</strong> — {{ spike.date }}
            <span class="spike-ratio">{{ spike.ratio }}x above average (score: {{ spike.value }})</span>
        </div>
        {% if spike.news %}
        <ul class="spike-news">
            {% for article in spike.news %}
            <li><a href="{{ article.url }}" target="_blank" rel="noopener">{{ article.title }}</a>
                <span class="news-meta">{{ article.source }}</span>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="spike-no-news">No matching news articles found for this date.</p>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}
